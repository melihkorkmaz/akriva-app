<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Design Token Playground — Akriva</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  /* ── Playground UI Chrome (dark) ── */
  :root {
    --ui-bg: #0f1117;
    --ui-surface: #1a1d27;
    --ui-surface-hover: #242833;
    --ui-border: #2a2e3a;
    --ui-text: #e2e4ea;
    --ui-text-muted: #8b8fa3;
    --ui-accent: #2563eb;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--ui-bg); color: var(--ui-text); height: 100vh; overflow: hidden; }

  .app { display: grid; grid-template-columns: 300px 1fr; height: 100vh; }

  /* ── Left Panel: Controls ── */
  .controls { background: var(--ui-surface); border-right: 1px solid var(--ui-border); overflow-y: auto; display: flex; flex-direction: column; }
  .controls-header { padding: 14px 16px; border-bottom: 1px solid var(--ui-border); display: flex; align-items: center; justify-content: space-between; }
  .controls-header h1 { font-size: 14px; font-weight: 700; }
  .controls-header .mode-toggle { background: var(--ui-surface-hover); border: 1px solid var(--ui-border); color: var(--ui-text); padding: 4px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; }
  .controls-header .mode-toggle:hover { background: #2f3340; }

  .presets-bar { padding: 10px 16px; border-bottom: 1px solid var(--ui-border); display: flex; gap: 4px; flex-wrap: wrap; }
  .preset-btn { background: var(--ui-surface-hover); border: 1px solid var(--ui-border); color: var(--ui-text-muted); padding: 4px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.15s; }
  .preset-btn:hover { color: var(--ui-text); border-color: var(--ui-accent); }
  .preset-btn.active { background: var(--ui-accent); color: #fff; border-color: var(--ui-accent); }

  .control-section { border-bottom: 1px solid var(--ui-border); }
  .section-toggle { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; cursor: pointer; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--ui-text-muted); background: none; border: none; width: 100%; text-align: left; }
  .section-toggle:hover { color: var(--ui-text); }
  .section-toggle .arrow { transition: transform 0.15s; font-size: 10px; }
  .section-toggle .arrow.open { transform: rotate(90deg); }
  .section-body { padding: 0 16px 12px; display: flex; flex-direction: column; gap: 10px; }
  .section-body.collapsed { display: none; }

  .control-row { display: flex; align-items: center; gap: 8px; }
  .control-label { font-size: 12px; color: var(--ui-text-muted); min-width: 100px; flex-shrink: 0; }
  .control-color { display: flex; align-items: center; gap: 6px; flex: 1; }
  .color-swatch-input { width: 28px; height: 28px; border: 1px solid var(--ui-border); border-radius: 4px; cursor: pointer; padding: 0; background: none; -webkit-appearance: none; appearance: none; }
  .color-swatch-input::-webkit-color-swatch-wrapper { padding: 0; }
  .color-swatch-input::-webkit-color-swatch { border: none; border-radius: 3px; }
  .color-hex { background: var(--ui-bg); border: 1px solid var(--ui-border); color: var(--ui-text); padding: 4px 8px; border-radius: 4px; font-size: 11px; font-family: monospace; width: 80px; }
  .color-hex:focus { outline: none; border-color: var(--ui-accent); }

  .control-slider { flex: 1; display: flex; align-items: center; gap: 8px; }
  .control-slider input[type="range"] { flex: 1; accent-color: var(--ui-accent); }
  .control-slider .value { font-size: 11px; font-family: monospace; color: var(--ui-text-muted); min-width: 36px; text-align: right; }

  .control-select { flex: 1; background: var(--ui-bg); border: 1px solid var(--ui-border); color: var(--ui-text); padding: 5px 8px; border-radius: 4px; font-size: 12px; }

  /* Export buttons */
  .export-bar { padding: 12px 16px; border-top: 1px solid var(--ui-border); display: flex; gap: 6px; margin-top: auto; }
  .export-btn { flex: 1; padding: 8px; border: 1px solid var(--ui-border); border-radius: 4px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.15s; background: var(--ui-surface-hover); color: var(--ui-text); }
  .export-btn:hover { border-color: var(--ui-accent); }
  .export-btn.copied { background: #16a34a; border-color: #16a34a; color: #fff; }

  /* ── Right Panel: Preview ── */
  .preview-area { display: flex; flex-direction: column; overflow: hidden; }

  .preview-viewport { flex: 1; overflow-y: auto; padding: 24px; display: flex; flex-direction: column; gap: 24px; align-items: center; }

  /* ── Mini Dashboard ── */
  .mini-dash { width: 100%; max-width: 820px; display: grid; grid-template-columns: 200px 1fr; border-radius: 12px; overflow: hidden; box-shadow: 0 0 0 1px rgba(255,255,255,0.06); min-height: 480px; }

  .mini-sidebar { padding: 16px; display: flex; flex-direction: column; gap: 4px; }
  .mini-sidebar .logo { font-size: 16px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
  .mini-sidebar .logo .logo-icon { width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; }
  .mini-sidebar .section-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.5; margin: 12px 0 4px; }
  .mini-nav-item { display: flex; align-items: center; gap: 8px; padding: 7px 10px; border-radius: 6px; font-size: 13px; cursor: default; transition: background 0.15s; }
  .mini-nav-item.active { font-weight: 600; }
  .mini-nav-item svg { width: 16px; height: 16px; opacity: 0.7; }
  .mini-sidebar-footer { margin-top: auto; display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 6px; }
  .mini-avatar { width: 32px; height: 32px; border-radius: 9999px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; flex-shrink: 0; }
  .mini-avatar-info { font-size: 12px; line-height: 1.3; }
  .mini-avatar-name { font-weight: 600; }
  .mini-avatar-email { opacity: 0.6; font-size: 11px; }

  .mini-main { padding: 24px; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; }

  .mini-breadcrumb { display: flex; align-items: center; gap: 6px; font-size: 13px; }
  .mini-breadcrumb .sep { opacity: 0.4; }
  .mini-breadcrumb .current { font-weight: 600; }

  .mini-page-title { font-size: 20px; font-weight: 600; }

  .mini-card { border-radius: 8px; border-width: 1px; border-style: solid; overflow: hidden; }
  .mini-card-header { padding: 20px 20px 0; }
  .mini-card-title { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
  .mini-card-desc { font-size: 13px; }
  .mini-card-content { padding: 20px; display: flex; flex-direction: column; gap: 14px; }
  .mini-card-footer { padding: 0 20px 20px; display: flex; gap: 8px; justify-content: flex-end; }

  .mini-form-row { display: flex; flex-direction: column; gap: 4px; }
  .mini-form-label { font-size: 13px; font-weight: 500; }
  .mini-form-input { height: 34px; border-width: 1px; border-style: solid; padding: 0 10px; font-size: 13px; background: transparent; font-family: inherit; }
  .mini-form-input::placeholder { opacity: 0.5; }
  .mini-form-select { height: 34px; border-width: 1px; border-style: solid; padding: 0 10px; font-size: 13px; background: transparent; font-family: inherit; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 10px center; }
  .mini-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

  .mini-btn { display: inline-flex; align-items: center; justify-content: center; height: 34px; padding: 0 16px; font-size: 13px; font-weight: 500; border: none; cursor: default; font-family: inherit; }
  .mini-btn.outline { background: transparent; border-width: 1px; border-style: solid; }

  .mini-separator { height: 1px; width: 100%; }

  .mini-badge { display: inline-flex; padding: 2px 10px; font-size: 11px; font-weight: 500; border-radius: 9999px; }

  .mini-alert { display: flex; gap: 10px; padding: 14px; border-width: 1px; border-style: solid; }
  .mini-alert-icon { flex-shrink: 0; margin-top: 1px; }
  .mini-alert-title { font-size: 13px; font-weight: 600; margin-bottom: 2px; }
  .mini-alert-desc { font-size: 13px; }

  .mini-progress { width: 100%; height: 8px; border-radius: 9999px; overflow: hidden; }
  .mini-progress-bar { height: 100%; border-radius: 9999px; }

  .mini-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }

  /* ── Token Swatches ── */
  .swatches-section { width: 100%; max-width: 820px; }
  .swatches-toggle { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; cursor: pointer; border: none; background: none; color: var(--ui-text); font-size: 13px; font-weight: 600; width: 100%; text-align: left; }
  .swatches-toggle .arrow { font-size: 10px; color: var(--ui-text-muted); transition: transform 0.15s; }
  .swatches-toggle .arrow.open { transform: rotate(90deg); }
  .swatches-body { display: flex; flex-direction: column; gap: 20px; padding-bottom: 24px; }
  .swatches-body.collapsed { display: none; }
  .swatch-group-title { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--ui-text-muted); margin-bottom: 8px; }
  .swatch-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 8px; }
  .swatch { border-radius: 6px; overflow: hidden; border: 1px solid var(--ui-border); }
  .swatch-color { height: 48px; }
  .swatch-info { padding: 6px 8px; background: var(--ui-surface); }
  .swatch-name { font-size: 10px; font-weight: 600; color: var(--ui-text); }
  .swatch-value { font-size: 10px; font-family: monospace; color: var(--ui-text-muted); }

  .shadow-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
  .shadow-box { height: 64px; border-radius: 8px; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 8px; font-size: 10px; font-weight: 600; color: var(--ui-text-muted); }

  .radius-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
  .radius-box { height: 56px; width: 100%; border: 2px solid var(--ui-accent); display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600; color: var(--ui-text-muted); background: var(--ui-surface); }

  .typo-samples { display: flex; flex-direction: column; gap: 8px; }
  .typo-row { display: flex; align-items: baseline; gap: 12px; }
  .typo-label { font-size: 10px; font-weight: 600; color: var(--ui-text-muted); min-width: 80px; text-align: right; flex-shrink: 0; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--ui-border); border-radius: 3px; }
</style>
</head>
<body>

<div class="app">
  <!-- Left: Controls -->
  <div class="controls">
    <div class="controls-header">
      <h1>Design Tokens</h1>
      <button class="mode-toggle" id="mode-toggle" onclick="toggleMode()">Light</button>
    </div>

    <div class="presets-bar" id="presets-bar"></div>

    <div id="control-sections"></div>

    <div class="export-bar">
      <button class="export-btn" id="copy-css" onclick="copyCSS()">Copy CSS</button>
      <button class="export-btn" id="copy-tw" onclick="copyTailwind()">Copy Tailwind</button>
    </div>
  </div>

  <!-- Right: Preview -->
  <div class="preview-area">
    <div class="preview-viewport" id="preview-viewport">
      <!-- Mini Dashboard -->
      <div class="mini-dash" id="mini-dash"></div>

      <!-- Token Swatches -->
      <div class="swatches-section">
        <button class="swatches-toggle" onclick="toggleSwatches()">
          Token Swatches <span class="arrow open" id="swatch-arrow">&#9654;</span>
        </button>
        <div class="swatches-body" id="swatches-body"></div>
      </div>
    </div>
  </div>
</div>

<script>
// ═══════════════════════════════════════════════════
// Presets
// ═══════════════════════════════════════════════════

const PRESETS = {
  'Akriva Default': {
    background: '#f7f8f9', foreground: '#1e293b', card: '#ffffff', cardForeground: '#1e293b',
    primary: '#2563eb', primaryForeground: '#ffffff', destructive: '#ef4444', destructiveForeground: '#ffffff',
    secondary: '#f1f5f9', mutedForeground: '#64748b', border: '#e5e7eb', input: '#e5e7eb', ring: '#2563eb',
    sidebar: '#1e293b', sidebarForeground: '#ffffff', sidebarAccent: '#2d3a4e',
    font: 'Inter', radius: 2, shadowIntensity: 5,
  },
  'Ocean': {
    background: '#f0f7ff', foreground: '#0c2d48', card: '#ffffff', cardForeground: '#0c2d48',
    primary: '#0077b6', primaryForeground: '#ffffff', destructive: '#d62828', destructiveForeground: '#ffffff',
    secondary: '#e0f0ff', mutedForeground: '#456b8a', border: '#c4ddf0', input: '#c4ddf0', ring: '#0077b6',
    sidebar: '#023e58', sidebarForeground: '#e0f0ff', sidebarAccent: '#0a5272',
    font: 'Inter', radius: 6, shadowIntensity: 6,
  },
  'Forest': {
    background: '#f6f9f4', foreground: '#1a2e1a', card: '#ffffff', cardForeground: '#1a2e1a',
    primary: '#2d6a4f', primaryForeground: '#ffffff', destructive: '#c1121f', destructiveForeground: '#ffffff',
    secondary: '#e9f5e3', mutedForeground: '#52796f', border: '#c8ddc0', input: '#c8ddc0', ring: '#2d6a4f',
    sidebar: '#1b3a2d', sidebarForeground: '#e9f5e3', sidebarAccent: '#2d5440',
    font: 'Inter', radius: 4, shadowIntensity: 4,
  },
  'Sunset': {
    background: '#fef9f4', foreground: '#2d1b0e', card: '#ffffff', cardForeground: '#2d1b0e',
    primary: '#e76f51', primaryForeground: '#ffffff', destructive: '#d62828', destructiveForeground: '#ffffff',
    secondary: '#fdebd0', mutedForeground: '#8b6c4f', border: '#f0d9b5', input: '#f0d9b5', ring: '#e76f51',
    sidebar: '#3d2214', sidebarForeground: '#fdebd0', sidebarAccent: '#5a3520',
    font: 'Inter', radius: 8, shadowIntensity: 7,
  },
  'Monochrome': {
    background: '#f5f5f5', foreground: '#171717', card: '#ffffff', cardForeground: '#171717',
    primary: '#404040', primaryForeground: '#ffffff', destructive: '#737373', destructiveForeground: '#ffffff',
    secondary: '#e5e5e5', mutedForeground: '#737373', border: '#d4d4d4', input: '#d4d4d4', ring: '#404040',
    sidebar: '#171717', sidebarForeground: '#e5e5e5', sidebarAccent: '#2e2e2e',
    font: 'Inter', radius: 0, shadowIntensity: 3,
  },
};

// ═══════════════════════════════════════════════════
// State
// ═══════════════════════════════════════════════════

const state = { ...PRESETS['Akriva Default'] };
let darkMode = false;
let activePreset = 'Akriva Default';
let swatchesOpen = true;

// ═══════════════════════════════════════════════════
// Control Sections Definition
// ═══════════════════════════════════════════════════

const SECTIONS = [
  { title: 'Surfaces', open: true, controls: [
    { key: 'background', label: 'Background', type: 'color' },
    { key: 'card', label: 'Card', type: 'color' },
    { key: 'secondary', label: 'Secondary', type: 'color' },
  ]},
  { title: 'Brand', open: true, controls: [
    { key: 'primary', label: 'Primary', type: 'color' },
    { key: 'primaryForeground', label: 'Primary Text', type: 'color' },
    { key: 'destructive', label: 'Destructive', type: 'color' },
  ]},
  { title: 'Text', open: true, controls: [
    { key: 'foreground', label: 'Foreground', type: 'color' },
    { key: 'cardForeground', label: 'Card Text', type: 'color' },
    { key: 'mutedForeground', label: 'Muted', type: 'color' },
  ]},
  { title: 'Borders', open: false, controls: [
    { key: 'border', label: 'Border', type: 'color' },
    { key: 'input', label: 'Input', type: 'color' },
    { key: 'ring', label: 'Focus Ring', type: 'color' },
  ]},
  { title: 'Sidebar', open: false, controls: [
    { key: 'sidebar', label: 'Background', type: 'color' },
    { key: 'sidebarForeground', label: 'Text', type: 'color' },
    { key: 'sidebarAccent', label: 'Accent', type: 'color' },
  ]},
  { title: 'Typography', open: false, controls: [
    { key: 'font', label: 'Font Family', type: 'select', options: ['Inter', 'System UI', 'Georgia', 'JetBrains Mono'] },
  ]},
  { title: 'Radius', open: false, controls: [
    { key: 'radius', label: 'Base', type: 'slider', min: 0, max: 16, unit: 'px' },
  ]},
  { title: 'Shadows', open: false, controls: [
    { key: 'shadowIntensity', label: 'Intensity', type: 'slider', min: 0, max: 10, unit: '' },
  ]},
];

// ═══════════════════════════════════════════════════
// Render Controls
// ═══════════════════════════════════════════════════

function renderPresets() {
  const el = document.getElementById('presets-bar');
  el.innerHTML = Object.keys(PRESETS).map(name =>
    `<button class="preset-btn${name === activePreset ? ' active' : ''}" onclick="applyPreset('${name}')">${name}</button>`
  ).join('');
}

function renderControls() {
  const el = document.getElementById('control-sections');
  el.innerHTML = SECTIONS.map((sec, si) => {
    const bodyClass = sec.open ? '' : ' collapsed';
    const arrowClass = sec.open ? ' open' : '';
    return `
      <div class="control-section">
        <button class="section-toggle" onclick="toggleSection(${si})">
          ${sec.title}
          <span class="arrow${arrowClass}" id="arrow-${si}">&#9654;</span>
        </button>
        <div class="section-body${bodyClass}" id="section-${si}">
          ${sec.controls.map(c => renderControl(c)).join('')}
        </div>
      </div>
    `;
  }).join('');
}

function renderControl(c) {
  if (c.type === 'color') {
    return `
      <div class="control-row">
        <span class="control-label">${c.label}</span>
        <div class="control-color">
          <input type="color" class="color-swatch-input" value="${state[c.key]}" oninput="updateColor('${c.key}', this.value)" />
          <input type="text" class="color-hex" value="${state[c.key]}" onchange="updateColor('${c.key}', this.value)" id="hex-${c.key}" />
        </div>
      </div>
    `;
  }
  if (c.type === 'slider') {
    return `
      <div class="control-row">
        <span class="control-label">${c.label}</span>
        <div class="control-slider">
          <input type="range" min="${c.min}" max="${c.max}" value="${state[c.key]}" oninput="updateSlider('${c.key}', this.value)" />
          <span class="value" id="val-${c.key}">${state[c.key]}${c.unit}</span>
        </div>
      </div>
    `;
  }
  if (c.type === 'select') {
    return `
      <div class="control-row">
        <span class="control-label">${c.label}</span>
        <select class="control-select" onchange="updateSelect('${c.key}', this.value)">
          ${c.options.map(o => `<option value="${o}" ${state[c.key] === o ? 'selected' : ''}>${o}</option>`).join('')}
        </select>
      </div>
    `;
  }
  return '';
}

function toggleSection(idx) {
  SECTIONS[idx].open = !SECTIONS[idx].open;
  const body = document.getElementById(`section-${idx}`);
  const arrow = document.getElementById(`arrow-${idx}`);
  body.classList.toggle('collapsed');
  arrow.classList.toggle('open');
}

// ═══════════════════════════════════════════════════
// State Updates
// ═══════════════════════════════════════════════════

function updateColor(key, val) {
  if (!/^#[0-9a-fA-F]{6}$/.test(val)) return;
  state[key] = val;
  activePreset = null;
  renderPresets();
  // Sync both inputs
  const swatch = document.querySelector(`input[type="color"][oninput*="${key}"]`);
  const hex = document.getElementById(`hex-${key}`);
  if (swatch) swatch.value = val;
  if (hex) hex.value = val;
  updateAll();
}

function updateSlider(key, val) {
  state[key] = Number(val);
  activePreset = null;
  renderPresets();
  const sec = SECTIONS.find(s => s.controls.some(c => c.key === key));
  const ctrl = sec?.controls.find(c => c.key === key);
  const display = document.getElementById(`val-${key}`);
  if (display) display.textContent = val + (ctrl?.unit || '');
  updateAll();
}

function updateSelect(key, val) {
  state[key] = val;
  activePreset = null;
  renderPresets();
  updateAll();
}

function applyPreset(name) {
  Object.assign(state, PRESETS[name]);
  activePreset = name;
  renderPresets();
  renderControls();
  updateAll();
}

function toggleMode() {
  darkMode = !darkMode;
  document.getElementById('mode-toggle').textContent = darkMode ? 'Dark' : 'Light';
  updateAll();
}

// ═══════════════════════════════════════════════════
// Derived Values
// ═══════════════════════════════════════════════════

function getRadius() {
  const base = state.radius;
  return { sm: Math.max(0, base - 4), md: Math.max(0, base - 2), lg: base, xl: base + 4 };
}

function getShadow(level) {
  const i = state.shadowIntensity / 10;
  const c = darkMode ? '0,0,0' : '30,41,59';
  const shadows = {
    '2xs': `0 1px 2px 0 rgba(${c},${(0.05 * i).toFixed(3)})`,
    'xs': `0 1px 2px 0 rgba(${c},${(0.05 * i).toFixed(3)})`,
    'sm': `0 2px 4px 0 rgba(${c},${(0.06 * i).toFixed(3)})`,
    'DEFAULT': `0 2px 4px 0 rgba(${c},${(0.06 * i).toFixed(3)}), 0 1px 2px -1px rgba(${c},${(0.04 * i).toFixed(3)})`,
    'md': `0 4px 8px -1px rgba(${c},${(0.08 * i).toFixed(3)})`,
    'lg': `0 10px 20px -3px rgba(${c},${(0.1 * i).toFixed(3)})`,
    'xl': `0 20px 30px -5px rgba(${c},${(0.12 * i).toFixed(3)})`,
    '2xl': `0 25px 50px -12px rgba(${c},${(0.2 * i).toFixed(3)})`,
  };
  return shadows[level] || shadows['DEFAULT'];
}

function getFontFamily() {
  const map = {
    'Inter': '"Inter", system-ui, sans-serif',
    'System UI': 'system-ui, -apple-system, sans-serif',
    'Georgia': 'Georgia, Cambria, "Times New Roman", serif',
    'JetBrains Mono': '"JetBrains Mono", ui-monospace, monospace',
  };
  return map[state.font] || map['Inter'];
}

function lighten(hex, amount) {
  let r = parseInt(hex.slice(1, 3), 16);
  let g = parseInt(hex.slice(3, 5), 16);
  let b = parseInt(hex.slice(5, 7), 16);
  r = Math.min(255, r + amount);
  g = Math.min(255, g + amount);
  b = Math.min(255, b + amount);
  return `#${r.toString(16).padStart(2,'0')}${g.toString(16).padStart(2,'0')}${b.toString(16).padStart(2,'0')}`;
}

function darken(hex, amount) { return lighten(hex, -amount); }

// ═══════════════════════════════════════════════════
// Mini Dashboard Rendering
// ═══════════════════════════════════════════════════

function renderDashboard() {
  const el = document.getElementById('mini-dash');
  const r = getRadius();
  const ff = getFontFamily();

  // Derive colors for dark mode adjustments
  const bg = darkMode ? darken(state.background, 60) : state.background;
  const fg = darkMode ? lighten(state.foreground, 180) : state.foreground;
  const card = darkMode ? darken(state.card, 50) : state.card;
  const cardFg = darkMode ? lighten(state.cardForeground, 180) : state.cardForeground;
  const brd = darkMode ? darken(state.border, 80) : state.border;
  const inp = darkMode ? darken(state.input, 70) : state.input;
  const muted = darkMode ? lighten(state.mutedForeground, 40) : state.mutedForeground;
  const sec = darkMode ? darken(state.secondary, 70) : state.secondary;

  el.innerHTML = `
    <!-- Sidebar -->
    <div class="mini-sidebar" style="background:${state.sidebar};color:${state.sidebarForeground};font-family:${ff};">
      <div class="logo">
        <div class="logo-icon" style="background:${state.primary};color:${state.primaryForeground};">A</div>
        <span>Akriva</span>
      </div>
      <div class="section-label">Data</div>
      <div class="mini-nav-item" style="background:${state.sidebarAccent};color:${state.sidebarForeground};" >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Dashboard
      </div>
      <div class="mini-nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
        Scope 1
      </div>
      <div class="mini-nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
        Scope 2
      </div>
      <div class="section-label">Admin</div>
      <div class="mini-nav-item active" style="color:${state.primary};">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        Settings
      </div>
      <div class="mini-nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Team
      </div>
      <div class="mini-sidebar-footer" style="border-top:1px solid ${state.sidebarAccent};padding-top:12px;">
        <div class="mini-avatar" style="background:${state.sidebarAccent};color:${state.sidebarForeground};">JD</div>
        <div class="mini-avatar-info">
          <div class="mini-avatar-name">Jane Doe</div>
          <div class="mini-avatar-email">jane@akriva.io</div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="mini-main" style="background:${bg};color:${fg};font-family:${ff};">
      <div class="mini-breadcrumb" style="color:${muted};">
        Settings <span class="sep">/</span> <span class="current" style="color:${fg};">Company</span>
      </div>
      <div class="mini-page-title">Company Settings</div>

      <!-- Card -->
      <div class="mini-card" style="background:${card};border-color:${brd};box-shadow:${getShadow('sm')};border-radius:${r.xl}px;">
        <div class="mini-card-header" style="color:${cardFg};">
          <div class="mini-card-title">Company Information</div>
          <div class="mini-card-desc" style="color:${muted};">Update your organization details</div>
        </div>
        <div class="mini-card-content">
          <div class="mini-form-grid">
            <div class="mini-form-row">
              <label class="mini-form-label" style="color:${cardFg};">Company Name</label>
              <input class="mini-form-input" style="color:${cardFg};border-color:${inp};border-radius:${r.md}px;" placeholder="Acme Corp" readonly />
            </div>
            <div class="mini-form-row">
              <label class="mini-form-label" style="color:${cardFg};">Country</label>
              <div class="mini-form-select" style="color:${muted};border-color:${inp};border-radius:${r.md}px;">Select country</div>
            </div>
          </div>
          <div class="mini-form-row">
            <label class="mini-form-label" style="color:${cardFg};">Sector</label>
            <div class="mini-form-select" style="color:${muted};border-color:${inp};border-radius:${r.md}px;">Select sector</div>
          </div>
          <div class="mini-separator" style="background:${brd};"></div>
          <div class="mini-row">
            <span class="mini-badge" style="background:${state.primary};color:${state.primaryForeground};">Admin</span>
            <span class="mini-badge" style="background:${sec};color:${fg};">Active</span>
            <span class="mini-badge" style="background:transparent;border:1px solid ${brd};color:${fg};">Draft</span>
          </div>
          <div class="mini-progress" style="background:${sec};">
            <div class="mini-progress-bar" style="background:${state.primary};width:65%;"></div>
          </div>
        </div>
        <div class="mini-card-footer">
          <div class="mini-btn outline" style="color:${cardFg};border-color:${inp};border-radius:${r.md}px;">Cancel</div>
          <div class="mini-btn" style="background:${state.primary};color:${state.primaryForeground};border-radius:${r.md}px;">Save Changes</div>
        </div>
      </div>

      <!-- Alert -->
      <div class="mini-alert" style="border-color:${brd};border-radius:${r.lg}px;background:${card};">
        <div class="mini-alert-icon" style="color:${fg};">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
        </div>
        <div class="mini-alert-content">
          <div class="mini-alert-title" style="color:${cardFg};">Reporting period open</div>
          <div class="mini-alert-desc" style="color:${muted};">FY2025 Q4 is ready for emission entries.</div>
        </div>
      </div>

      <!-- Destructive Alert -->
      <div class="mini-alert" style="border-color:${state.destructive};border-radius:${r.lg}px;background:${card};">
        <div class="mini-alert-icon" style="color:${state.destructive};">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        </div>
        <div class="mini-alert-content">
          <div class="mini-alert-title" style="color:${state.destructive};">Missing data</div>
          <div class="mini-alert-desc" style="color:${muted};">3 facilities have not submitted Scope 1 data.</div>
        </div>
      </div>
    </div>
  `;
}

// ═══════════════════════════════════════════════════
// Token Swatches Rendering
// ═══════════════════════════════════════════════════

function renderSwatches() {
  const el = document.getElementById('swatches-body');
  const r = getRadius();

  const colorTokens = [
    { name: 'background', color: state.background },
    { name: 'foreground', color: state.foreground },
    { name: 'card', color: state.card },
    { name: 'card-fg', color: state.cardForeground },
    { name: 'primary', color: state.primary },
    { name: 'primary-fg', color: state.primaryForeground },
    { name: 'destructive', color: state.destructive },
    { name: 'secondary', color: state.secondary },
    { name: 'muted-fg', color: state.mutedForeground },
    { name: 'border', color: state.border },
    { name: 'input', color: state.input },
    { name: 'ring', color: state.ring },
    { name: 'sidebar', color: state.sidebar },
    { name: 'sidebar-fg', color: state.sidebarForeground },
    { name: 'sidebar-accent', color: state.sidebarAccent },
  ];

  const shadowLevels = ['2xs', 'xs', 'sm', 'DEFAULT', 'md', 'lg', 'xl', '2xl'];
  const radiusLevels = [
    { name: 'sm', val: r.sm },
    { name: 'md', val: r.md },
    { name: 'lg', val: r.lg },
    { name: 'xl', val: r.xl },
  ];

  const ff = getFontFamily();

  el.innerHTML = `
    <!-- Colors -->
    <div>
      <div class="swatch-group-title">Colors</div>
      <div class="swatch-grid">
        ${colorTokens.map(t => `
          <div class="swatch">
            <div class="swatch-color" style="background:${t.color};"></div>
            <div class="swatch-info">
              <div class="swatch-name">${t.name}</div>
              <div class="swatch-value">${t.color}</div>
            </div>
          </div>
        `).join('')}
      </div>
    </div>

    <!-- Shadows -->
    <div>
      <div class="swatch-group-title">Shadows</div>
      <div class="shadow-grid">
        ${shadowLevels.map(l => `
          <div class="shadow-box" style="background:${state.card};box-shadow:${getShadow(l)};border-radius:${r.lg}px;">
            ${l === 'DEFAULT' ? 'base' : l}
          </div>
        `).join('')}
      </div>
    </div>

    <!-- Radius -->
    <div>
      <div class="swatch-group-title">Border Radius</div>
      <div class="radius-grid">
        ${radiusLevels.map(l => `
          <div class="radius-box" style="border-radius:${l.val}px;">
            ${l.name} (${l.val}px)
          </div>
        `).join('')}
      </div>
    </div>

    <!-- Typography -->
    <div>
      <div class="swatch-group-title">Typography</div>
      <div class="typo-samples" style="font-family:${ff};color:${state.foreground};background:${state.background};padding:16px;border-radius:8px;border:1px solid var(--ui-border);">
        <div class="typo-row">
          <span class="typo-label">Page Title</span>
          <span style="font-size:20px;font-weight:600;">Company Settings</span>
        </div>
        <div class="typo-row">
          <span class="typo-label">Section</span>
          <span style="font-size:18px;font-weight:600;">Emission Sources</span>
        </div>
        <div class="typo-row">
          <span class="typo-label">Card Title</span>
          <span style="font-size:16px;font-weight:600;">Scope 1 Summary</span>
        </div>
        <div class="typo-row">
          <span class="typo-label">Body</span>
          <span style="font-size:14px;">Configure reporting preferences for your organization.</span>
        </div>
        <div class="typo-row">
          <span class="typo-label">Small</span>
          <span style="font-size:13px;">Last updated 2 hours ago</span>
        </div>
        <div class="typo-row">
          <span class="typo-label">Helper</span>
          <span style="font-size:12px;color:${state.mutedForeground};">Select the GHG Protocol authority for calculations</span>
        </div>
      </div>
    </div>
  `;
}

function toggleSwatches() {
  swatchesOpen = !swatchesOpen;
  document.getElementById('swatches-body').classList.toggle('collapsed');
  document.getElementById('swatch-arrow').classList.toggle('open');
}

// ═══════════════════════════════════════════════════
// Export
// ═══════════════════════════════════════════════════

function generateCSS() {
  const r = getRadius();
  return `:root {
  /* Core surfaces */
  --background: ${state.background};
  --foreground: ${state.foreground};
  --card: ${state.card};
  --card-foreground: ${state.cardForeground};
  --popover: ${state.card};
  --popover-foreground: ${state.cardForeground};

  /* Primary */
  --primary: ${state.primary};
  --primary-foreground: ${state.primaryForeground};

  /* Secondary / Muted / Accent */
  --secondary: ${state.secondary};
  --secondary-foreground: ${state.foreground};
  --muted: ${state.secondary};
  --muted-foreground: ${state.mutedForeground};
  --accent: ${state.secondary};
  --accent-foreground: ${state.foreground};

  /* Destructive */
  --destructive: ${state.destructive};
  --destructive-foreground: ${state.destructiveForeground};

  /* Borders & inputs */
  --border: ${state.border};
  --input: ${state.input};
  --ring: ${state.ring};

  /* Sidebar */
  --sidebar: ${state.sidebar};
  --sidebar-foreground: ${state.sidebarForeground};
  --sidebar-primary: ${state.primary};
  --sidebar-primary-foreground: ${state.primaryForeground};
  --sidebar-accent: ${state.sidebarAccent};
  --sidebar-accent-foreground: ${state.sidebarForeground};
  --sidebar-border: ${state.sidebarAccent};
  --sidebar-ring: ${state.ring};

  /* Fonts */
  --font-sans: ${getFontFamily()};

  /* Radius */
  --radius: ${state.radius}px;

  /* Shadows */
  --shadow-2xs: ${getShadow('2xs')};
  --shadow-xs: ${getShadow('xs')};
  --shadow-sm: ${getShadow('sm')};
  --shadow: ${getShadow('DEFAULT')};
  --shadow-md: ${getShadow('md')};
  --shadow-lg: ${getShadow('lg')};
  --shadow-xl: ${getShadow('xl')};
  --shadow-2xl: ${getShadow('2xl')};
}`;
}

function generateTailwind() {
  return `@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);

  --font-sans: var(--font-sans);

  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);

  --shadow-2xs: var(--shadow-2xs);
  --shadow-xs: var(--shadow-xs);
  --shadow-sm: var(--shadow-sm);
  --shadow: var(--shadow);
  --shadow-md: var(--shadow-md);
  --shadow-lg: var(--shadow-lg);
  --shadow-xl: var(--shadow-xl);
  --shadow-2xl: var(--shadow-2xl);
}`;
}

function copyCSS() {
  navigator.clipboard.writeText(generateCSS()).then(() => flashBtn('copy-css'));
}

function copyTailwind() {
  const full = generateCSS() + '\n\n' + generateTailwind();
  navigator.clipboard.writeText(full).then(() => flashBtn('copy-tw'));
}

function flashBtn(id) {
  const btn = document.getElementById(id);
  const orig = btn.textContent;
  btn.textContent = 'Copied!';
  btn.classList.add('copied');
  setTimeout(() => { btn.textContent = orig; btn.classList.remove('copied'); }, 1500);
}

// ═══════════════════════════════════════════════════
// Master Update
// ═══════════════════════════════════════════════════

function updateAll() {
  renderDashboard();
  renderSwatches();
}

// ═══════════════════════════════════════════════════
// Init
// ═══════════════════════════════════════════════════

renderPresets();
renderControls();
updateAll();
</script>

</body>
</html>
