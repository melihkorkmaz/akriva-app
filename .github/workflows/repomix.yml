name: Generate Repomix Snapshot

on:
  push:
    branches: [main]

permissions:
  contents: read

jobs:
  repomix:
    name: Generate Codebase Snapshot
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 50

      - name: Pack repository with Repomix
        id: repomix
        uses: yamadashy/repomix/.github/actions/repomix@main
        with:
          output: akriva-frontend.md
          style: markdown
          compress: true
          additional-args: --include-logs

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: repomix-codebase-snapshot
          path: ${{ steps.repomix.outputs.output_file }}
          retention-days: 30
